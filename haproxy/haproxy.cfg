global
   log 127.0.0.1   local0         # Enable per-instance logging of events and traffic.
   log 127.0.0.1   local1 notice  # only send important events
   maxconn 4096                   # the server will handle up to 4096 simultaneous connections.
   user haproxy
   group haproxy
   daemon                         # the server will put itself in the background when launched.
   nbproc      2                  # number of processes when launched 2.

defaults
    # default mode will be http (as opposed to tcp)
    mode http
    # Enable early dropping of aborted requests pending in queues
    option abortonclose           
    # Set the maximum inactivity time on the client side
    timeout client  5000
    # Enable HTTP connection closing on the server side
    option http-server-close
    # Return a file contents instead of errors generated by HAProxy
    no option accept-invalid-http-request
    # Enable or disable relaxing of HTTP response parsing
    no option accept-invalid-http-response
    # By default, the first operational backup server gets all traffic when normal servers are all down
    option allbackups
    # Enable insertion of the X-Forwarded-For header to requests sent to servers
    option forwardfor except 127.0.0.1 header X-Forwarded-For
    # Enable session redistribution in case of connection failure.
    option redispatch             
    # Set the number of retries to perform on a server after a connection failure
    retries 3                     
    # Enable the saving of one ACK packet during the connect sequence
    option tcp-smart-connect      
    # Fix the maximum number of concurrent connections on a frontend
    maxconn 2000                  
    # Set the maximum time to wait for a connection attempt to a server to succeed
    contimeout      5000          
    # Set the maximum inactivity time on the client side
    clitimeout      50000         
    # Set the maximum inactivity time on the server side
    srvtimeout      50000         

#this frontend interface receives the incoming http requests
frontend all 0.0.0.0:3000
    timeout client 1h
    # use apache2 as default webserver for incoming traffic
    default_backend nodejs_homolog.jomow.com.br

    acl is_nodejs_admin.jomow.com.br hdr_end(host) -i admin.jomow.com.br
    use_backend nodejs_admin.jomow.com.br if is_nodejs_admin.jomow.com.br

    acl is_nodejs_homolog.jomow.com.br hdr_end(host) -i homolog.jomow.com.br
    use_backend nodejs_homolog.jomow.com.br if is_nodejs_homolog.jomow.com.br

    acl is_nodejs_jomow.com.br hdr_end(host) -i jomow.com.br
    use_backend nodejs_jomow.com.br if is_nodejs_jomow.com.br

    acl is_nodejs_gessocentral.com.br hdr_end(host) -i gessocentral.com.br
    use_backend nodejs_gessocentral.com.br if is_nodejs_gessocentral.com.br

    acl is_nodejs_ajrc.com.br hdr_end(host) -i ajrc.com.br
    use_backend nodejs_ajrc.com.br if is_nodejs_ajrc.com.br

    acl is_nodejs_reisconobras.com.br hdr_end(host) -i reisconobras.com.br
    use_backend nodejs_reisconobras.com.br if is_nodejs_reisconobras.com.br

    acl is_nodejs_maniadeartesanato.com.br hdr_end(host) -i maniadeartesanato.com.br
    use_backend nodejs_maniadeartesanato.com.br if is_nodejs_maniadeartesanato.com.br

    acl is_nodejs_marciabraga.com.br hdr_end(host) -i marciabraga.com.br
    use_backend nodejs_marciabraga.com.br if is_nodejs_marciabraga.com.br

    acl is_nodejs_admin.facilitiimoveis.com.br hdr_end(host) -i admin.facilitiimoveis.com.br
    use_backend nodejs_admin.jomow.com.br if is_nodejs_admin.facilitiimoveis.com.br

    acl is_nodejs_facilitiimoveis.com.br hdr_end(host) -i facilitiimoveis.com.br
    use_backend nodejs_facilitiimoveis.com.br if is_nodejs_facilitiimoveis.com.br



backend nodejs_jomow.com.br
    balance roundrobin
    cookie  SERVERID insert indirect nocache
    server server1 127.0.0.1:8081 cookie server1
#    server server2 192.168.122.1:3001 cookie server2
#    server server3 192.168.122.1:3002 cookie server3

backend nodejs_homolog.jomow.com.br
    balance roundrobin
    cookie  SERVERID insert indirect nocache
    server server1 127.0.0.1:8083 cookie server1
    server server2 127.0.0.1:3001 cookie server2
#    server server3 192.168.122.1:3002 cookie server3

backend nodejs_gessocentral.com.br
    balance roundrobin
    cookie  SERVERID insert indirect nocache
    server server1 127.0.0.1:8082 cookie server1
#    server server2 192.168.122.1:3001 cookie server2
#    server server3 192.168.122.1:3002 cookie server3

backend nodejs_default
    balance roundrobin
    cookie  SERVERID insert indirect nocache
    server server1 127.0.0.1:8080 cookie server1
#    server server2 192.168.122.1:3001 cookie server2
#    server server3 192.168.122.1:3002 cookie server3

backend nodejs_admin.jomow.com.br
    balance roundrobin
    cookie  SERVERID insert indirect nocache
    server server1 107.170.53.184:3000 cookie server1
#    server server2 192.168.122.1:3001 cookie server2
#    server server3 192.168.122.1:3002 cookie server3

backend nodejs_ajrc.com.br
    balance roundrobin
    cookie  SERVERID insert indirect nocache
    server server1 127.0.0.1:8085 cookie server1
#    server server2 127.0.0.1:8087 cookie server2
#    server server3 127.0.0.1:8088 cookie server3

backend nodejs_reisconobras.com.br
    balance roundrobin
    cookie  SERVERID insert indirect nocache
    server server1 127.0.0.1:8086 cookie server1
#    server server2 192.168.122.1:3001 cookie server2
#    server server3 192.168.122.1:3002 cookie server3

backend nodejs_maniadeartesanato.com.br
    balance roundrobin
    cookie  SERVERID insert indirect nocache
    server server1 127.0.0.1:8087 cookie server1
#    server server2 192.168.122.1:3001 cookie server2
#    server server3 192.168.122.1:3002 cookie server3

backend nodejs_marciabraga.com.br
    balance roundrobin
    cookie  SERVERID insert indirect nocache
    server server1 127.0.0.1:8087 cookie server1
#    server server2 192.168.122.1:3001 cookie server2
#    server server3 192.168.122.1:3002 cookie server3

backend nodejs_facilitiimoveis.com.br
    balance roundrobin
    cookie  SERVERID insert indirect nocache
    server server1 107.170.53.184:3001 cookie server1
#    server server2 192.168.122.1:3001 cookie server2
#    server server3 192.168.122.1:3002 cookie server3

